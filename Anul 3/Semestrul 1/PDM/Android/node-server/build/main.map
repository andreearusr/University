{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/authorization/index.js","webpack:///./src/authorization/router.js","webpack:///./src/authorization/store.js","webpack:///./src/index.js","webpack:///./src/specialEvent/index.js","webpack:///./src/specialEvent/router.js","webpack:///./src/specialEvent/store.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wss.js","webpack:///external \"@koa/cors\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","request","credentials","findOne","password","UserStore","constructor","filename","autoload","store","dataStore","props","result","Error","app","Koa","server","http","createServer","callback","wss","WebSocket","Server","initWss","use","cors","timingLogger","exceptionHandler","bodyParser","prefix","publicApiRouter","authorizationRouter","routes","allowedMethods","protectedApiRouter","specialEventRouter","listen","console","log","get","userId","state","SpecialEventStore","find","specialEvent","params","id","createSpecialEvent","broadcast","type","payload","put","specialEventId","updatedCount","update","del","note","remove","specialEventTitle","title","specialEventNumberOfPeople","numberOfPeople","undefined","specialEventDate","date","specialEventIsApproved","isApproved","next","start","Date","now","end","d","hour","getHours","getMinutes","getSeconds","getMilliseconds","method","url","value","on","ws","JSON","parse","close","verify","data","clients","forEach","client","readyState","OPEN","send","stringify"],"mappings":"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,EACR,MAAM,IAAIC,KAAK,CAAC,kCAAkC,CAAC;IACrD,OAAO,IAAI,CAACJ,KAAK,CAAClB,MAAM,CAACX,IAAI,CAAC;EAChC;AACF;AAEe,mEAAIyB,SAAS,CAAC;EAAEE,QAAQ,EAAE,iBAAiB;EAAEC,QAAQ,EAAE;AAAK,CAAC,CAAC,E;;;;;;;;;;;;ACnB7E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAGsB;AACK;AACH;AACQ;AACQ;AACmD;AAC7B;AACE;AACtC;AACG;AAE7B,MAAMM,GAAG,GAAG,IAAIC,0CAAG,EAAE;AACrB,MAAMC,MAAM,GAAGC,2CAAI,CAACC,YAAY,CAACJ,GAAG,CAACK,QAAQ,EAAE,CAAC;AAChD,MAAMC,GAAG,GAAG,IAAIC,yCAAS,CAACC,MAAM,CAAC;EAAEN;AAAO,CAAC,CAAC;AAC5C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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router';","import Router from 'koa-router';\r\nimport userStore from './store';\r\nimport jwt from 'jsonwebtoken';\r\nimport { jwtConfig } from '../utils';\r\n\r\nexport const router = new Router();\r\n\r\nconst createToken = (user) => {\r\n  return jwt.sign({ username: user.username, _id: user._id }, jwtConfig.secret, { expiresIn: 60 * 60 * 60 });\r\n};\r\n\r\nconst createUser = async (user, response) => {\r\n  try {\r\n    await userStore.insert(user);\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } catch (err) {\r\n    response.body = { issue: [{ error: err.message }] };\r\n    response.status = 400; // bad request\r\n  }\r\n};\r\n\r\nrouter.post('/signup', async (ctx) => await createUser(ctx.request.body, ctx.response));\r\n\r\nrouter.post('/login', async (ctx) => {\r\n  const credentials = ctx.request.body;\r\n  const response = ctx.response;\r\n  const user = await userStore.findOne({ username: credentials.username });\r\n  if (user && credentials.password === user.password) {\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } else {\r\n    response.body = { issue: [{ error: 'Invalid credentials' }] };\r\n    response.status = 400; // bad request\r\n  }\r\n});\r\n","import dataStore from 'nedb-promise';\r\n\r\nexport class UserStore {\r\n  constructor({ filename, autoload }) {\r\n    this.store = dataStore({ filename, autoload });\r\n  }\r\n  \r\n  async findOne(props) {\r\n    return this.store.findOne(props);\r\n  }\r\n  \r\n  async insert(user) {\r\n    const result = await this.findOne({ username: user.username });\r\n    if (result)\r\n      throw new Error(\"This username is already taken !\");\r\n    return this.store.insert(user);\r\n  };\r\n}\r\n\r\nexport default new UserStore({ filename: './db/users.json', autoload: true });","// const Koa = require('koa');\r\n// const app = new Koa();\r\n// const server = require('http').createServer(app.callback());\r\n// const WebSocket = require('ws');\r\n// const wss = new WebSocket.Server({ server });\r\n// const Router = require('koa-router');\r\n// const cors = require('koa-cors');\r\n// const bodyparser = require('koa-bodyparser');\r\n\r\n// app.use(bodyparser());\r\n// app.use(cors());\r\n// app.use(async (ctx, next) => {\r\n//   const start = new Date();\r\n//   await next();\r\n//   const ms = new Date() - start;\r\n//   console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n// });\r\n\r\n// app.use(async (ctx, next) => {\r\n//   await new Promise(resolve => setTimeout(resolve, 2000));\r\n//   await next();\r\n// });\r\n\r\n// app.use(async (ctx, next) => {\r\n//   try {\r\n//     await next();\r\n//   } catch (err) {\r\n//     ctx.response.body = { issue: [{ error: err.message || 'Unexpected error' }] };\r\n//     ctx.response.status = 500;\r\n//   }\r\n// });\r\n\r\n// class Item {\r\n//   constructor({ id, title, date, numberOfPeople, isApproved }) {\r\n//     this.id = id;\r\n//     this.title = title;\r\n//     this.date = date;\r\n//     this.numberOfPeople = numberOfPeople;\r\n//     this.isApproved = isApproved;\r\n//   }\r\n// }\r\n\r\n// const items = [];\r\n// for (let i = 0; i < 3; i++) {\r\n//   items.push(new Item({ id: `${i}`, title: `Event ${i}`, date: new Date(Date.now()),numberOfPeople: 50, isApproved: false }));\r\n// }\r\n// let lastUpdated = items[items.length - 1].date;\r\n// let lastId = items[items.length - 1].id;\r\n// const pageSize = 10;\r\n\r\n// const broadcast = data =>\r\n//   wss.clients.forEach(client => {\r\n//     if (client.readyState === WebSocket.OPEN) {\r\n//       client.send(JSON.stringify(data));\r\n//     }\r\n//   });\r\n\r\n// const router = new Router();\r\n\r\n// router.get('/specialEvent', ctx => {\r\n//   ctx.response.body = items;\r\n//   ctx.response.status = 200;\r\n// });\r\n\r\n// router.get('/specialEvent/:id', async (ctx) => {\r\n//   const itemId = ctx.request.params.id;\r\n//   const item = items.find(item => itemId === item.id);\r\n//   if (item) {\r\n//     ctx.response.body = item;\r\n//     ctx.response.status = 200; // ok\r\n//   } else {\r\n//     ctx.response.body = { issue: [{ warning: `item with id ${itemId} not found` }] };\r\n//     ctx.response.status = 404; // NOT FOUND (if you know the resource was deleted, then return 410 GONE)\r\n//   }\r\n// });\r\n\r\n// const createItem = async (ctx) => {\r\n//   const item = ctx.request.body;\r\n//   if (!item.title || item.title==\"\") { // validation\r\n//     ctx.response.body = { issue: [{ error: 'Title is incorrect' }] };\r\n//     ctx.response.status = 400; //  BAD REQUEST\r\n//     return;\r\n//   }\r\n//   item.id = `${parseInt(lastId) + 1}`;\r\n//   lastId = item.id;\r\n//   items.push(item);\r\n//   ctx.response.body = item;\r\n//   ctx.response.status = 201; // CREATED\r\n//   broadcast({ event: 'created', payload: { item } });\r\n// };\r\n\r\n// router.post('/specialEvent', async (ctx) => {\r\n//   await createItem(ctx);\r\n// });\r\n\r\n// router.put('/specialEvent/:id', async (ctx) => {\r\n//   const id = ctx.params.id;\r\n//   const item = ctx.request.body;\r\n//   const itemId = item.id;\r\n//   if (itemId && id !== item.id) {\r\n//     ctx.response.body = { issue: [{ error: `Param id and body id should be the same` }] };\r\n//     ctx.response.status = 400; // BAD REQUEST\r\n//     return;\r\n//   }\r\n//   if (!itemId) {\r\n//     await createItem(ctx);\r\n//     return;\r\n//   }\r\n//   const index = items.findIndex(item => item.id === id);\r\n//   if (index === -1) {\r\n//     ctx.response.body = { issue: [{ error: `item with id ${id} not found` }] };\r\n//     ctx.response.status = 400; // BAD REQUEST\r\n//     return;\r\n//   }\r\n//   items[index] = item;\r\n//   lastUpdated = new Date();\r\n//   ctx.response.body = item;\r\n//   ctx.response.status = 200; // OK\r\n//   broadcast({ event: 'updated', payload: { item } });\r\n// });\r\n\r\n// router.del('/specialEvent/:id', ctx => {\r\n//   const id = ctx.params.id;\r\n//   const index = items.findIndex(item => id === item.id);\r\n//   if (index !== -1) {\r\n//     const item = items[index];\r\n//     items.splice(index, 1);\r\n//     lastUpdated = new Date();\r\n//     broadcast({ event: 'deleted', payload: { item } });\r\n//   }\r\n//   ctx.response.status = 204; // no content\r\n// });\r\n\r\n// // setInterval(() => {\r\n// //   lastUpdated = new Date();\r\n// //   lastId = `${parseInt(lastId) + 1}`;\r\n// //   const item = new Item({ id: lastId, text: `event ${lastId}`, date: new Date(), isApproved: false, numberOfPeople: 50 });\r\n// //   items.push(item);\r\n// //   console.log(`\r\n// //    ${item.text}`);\r\n// //   broadcast({ event: 'created', payload: { item } });\r\n// // }, 1000);\r\n\r\n// app.use(router.routes());\r\n// app.use(router.allowedMethods());\r\n\r\n// server.listen(3000);\r\n\r\n\r\nimport Koa from 'koa';\r\nimport WebSocket from 'ws';\r\nimport http from 'http';\r\nimport Router from 'koa-router';\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport { timingLogger, exceptionHandler, jwtConfig, initWss, verifyClient } from './utils';\r\nimport { router as specialEventRouter } from './specialEvent';\r\nimport { router as authorizationRouter } from './authorization';\r\nimport jwt from 'koa-jwt';\r\nimport cors from '@koa/cors';\r\n\r\nconst app = new Koa();\r\nconst server = http.createServer(app.callback());\r\nconst wss = new WebSocket.Server({ server });\r\ninitWss(wss);\r\n\r\napp.use(cors());\r\napp.use(timingLogger);\r\napp.use(exceptionHandler);\r\napp.use(bodyParser());\r\n\r\nconst prefix = '/api';\r\n\r\n// public\r\nconst publicApiRouter = new Router({ prefix });\r\npublicApiRouter\r\n  .use('/auth', authorizationRouter.routes());\r\napp\r\n  .use(publicApiRouter.routes())\r\n  .use(publicApiRouter.allowedMethods());\r\n\r\napp.use(jwt(jwtConfig));\r\n\r\n// protected\r\nconst protectedApiRouter = new Router({ prefix });\r\nprotectedApiRouter\r\n  .use('/specialEvent', specialEventRouter.routes());\r\napp\r\n  .use(protectedApiRouter.routes())\r\n  .use(protectedApiRouter.allowedMethods());\r\n\r\nserver.listen(3000);\r\nconsole.log('started on port 3000');\r\n","export * from './router';","import Router from 'koa-router';\r\nimport SpecialEventStore from './store';\r\nimport { broadcast } from \"../utils\";\r\n\r\nexport const router = new Router();\r\n\r\nrouter.get('/', async (ctx) => {\r\n  const response = ctx.response;\r\n  const userId = ctx.state.user._id;\r\n  response.body = await SpecialEventStore.find({ userId });\r\n  response.status = 200; // ok\r\n});\r\n\r\nrouter.get('/:id', async (ctx) => {\r\n  const userId = ctx.state.user._id;\r\n  const specialEvent = await SpecialEventStore.findOne({ _id: ctx.params.id });\r\n  const response = ctx.response;\r\n  if (specialEvent) {\r\n    if (specialEvent.userId === userId) {\r\n      response.body = specialEvent;\r\n      response.status = 200; // ok\r\n    } else {\r\n      response.status = 403; // forbidden\r\n    }\r\n  } else {\r\n    response.status = 404; // not found\r\n  }\r\n});\r\n\r\nconst createSpecialEvent = async (ctx, specialEvent, response) => {\r\n  try {\r\n    const userId = ctx.state.user._id;\r\n    specialEvent.userId = userId;\r\n    response.body = await SpecialEventStore.insert(specialEvent);\r\n    response.status = 201; // created\r\n    broadcast(userId, { type: 'created', payload: specialEvent });\r\n  } catch (err) {\r\n    response.body = { message: err.message };\r\n    response.status = 400; // bad request\r\n  }\r\n};\r\n\r\nrouter.post('/', async ctx => await createSpecialEvent(ctx, ctx.request.body, ctx.response));\r\n\r\nrouter.put('/:id', async (ctx) => {\r\n  const specialEvent = ctx.request.body;\r\n  const id = ctx.params.id;\r\n  const specialEventId = specialEvent._id;\r\n  const response = ctx.response;\r\n  if (specialEventId && specialEventId !== id) {\r\n    response.body = { message: 'Param id and body _id should be the same' };\r\n    response.status = 400; // bad request\r\n    return;\r\n  }\r\n  if (!specialEventId) {\r\n    await createSpecialEvent(ctx, specialEvent, response);\r\n  } else {\r\n    const userId = ctx.state.user._id;\r\n    specialEvent.userId = userId;\r\n    const updatedCount = await SpecialEventStore.update({ _id: id }, specialEvent);\r\n    if (updatedCount === 1) {\r\n      response.body = specialEvent;\r\n      response.status = 200; // ok\r\n      broadcast(userId, { type: 'updated', payload: specialEvent });\r\n    } else {\r\n      response.body = { message: 'Resource no longer exists' };\r\n      response.status = 405; // method not allowed\r\n    }\r\n  }\r\n});\r\n\r\nrouter.del('/:id', async (ctx) => {\r\n  const userId = ctx.state.user._id;\r\n  const note = await SpecialEventStore.findOne({ _id: ctx.params.id });\r\n  if (note && userId !== note.userId) {\r\n    ctx.response.status = 403; // forbidden\r\n  } else {\r\n    await SpecialEventStore.remove({ _id: ctx.params.id });\r\n    ctx.response.status = 204; // no content\r\n  }\r\n});\r\n","import dataStore from 'nedb-promise';\r\n\r\nexport class SpecialEventStore {\r\n  constructor({ filename, autoload }) {\r\n    this.store = dataStore({ filename, autoload });\r\n  }\r\n  \r\n  async find(props) {\r\n    return this.store.find(props);\r\n  }\r\n  \r\n  async findOne(props) {\r\n    return this.store.findOne(props);\r\n  }\r\n  \r\n  async insert(specialEvent) {\r\n    let specialEventTitle = specialEvent.title;\r\n    if (!specialEventTitle) {\r\n      throw new Error('Missing title property')\r\n    }\r\n    let specialEventNumberOfPeople = specialEvent.numberOfPeople;\r\n    if (specialEventNumberOfPeople === undefined || specialEventNumberOfPeople === null) {\r\n      throw new Error('Missing number of people property')\r\n    }\r\n    let specialEventDate = specialEvent.date;\r\n    if (specialEventDate === undefined || specialEventDate === null) {\r\n      throw new Error('Missing date property')\r\n    }\r\n    let specialEventIsApproved = specialEvent.isApproved;\r\n    if (specialEventIsApproved === undefined || specialEventIsApproved === null) {\r\n      throw new Error('Missing is approved property')\r\n    }\r\n    return this.store.insert(specialEvent);\r\n  };\r\n  \r\n  async update(props, specialEvent) {\r\n    return this.store.update(props, specialEvent);\r\n  }\r\n  \r\n  async remove(props) {\r\n    return this.store.remove(props);\r\n  }\r\n}\r\n\r\nexport default new SpecialEventStore({ filename: './db/specialEvents.json', autoload: true });","export const jwtConfig = { secret: 'my-secret' };\r\n","export * from './constants';\r\nexport * from './middlewares';\r\nexport * from './wss';\r\n","export const exceptionHandler = async (ctx, next) => {\r\n  try {\r\n    return await next();\r\n  } catch (err) {\r\n    ctx.body = { message: err.message || 'Unexpected error.' };\r\n    ctx.status = err.status || 500;\r\n  }\r\n};\r\n\r\nexport const timingLogger = async (ctx, next) => {\r\n  const start = Date.now();\r\n  await next();\r\n  const end = Date.now();\r\n\r\n  const d = new Date(start);\r\n  const hour = `${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}.${d.getMilliseconds()}`;\r\n\r\n  console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${end - start}ms @ ${hour}`);\r\n};\r\n","import WebSocket from \"ws\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { jwtConfig } from \"./constants\";\r\n\r\nlet wss;\r\n\r\nexport const initWss = value => {\r\n  wss = value;\r\n  wss.on('connection', ws => {\r\n    ws.on('message', message => {\r\n      const { type, payload: { token } } = JSON.parse(message);\r\n      if (type !== 'authorization') {\r\n        ws.close();\r\n        return;\r\n      }\r\n      try {\r\n        ws.user = jwt.verify(token, jwtConfig.secret);\r\n      } catch (err) {\r\n        ws.close();\r\n      }\r\n    })\r\n  });\r\n};\r\n\r\nexport const broadcast = (userId, data) => {\r\n  if (!wss) {\r\n    return;\r\n  }\r\n  wss.clients.forEach(client => {\r\n    if (client.readyState === WebSocket.OPEN && userId === client.user._id) {\r\n      console.log(`broadcast sent to ${client.user.username}`);\r\n      client.send(JSON.stringify(data));\r\n    }\r\n  });\r\n};\r\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}